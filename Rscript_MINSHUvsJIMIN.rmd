```{r}
#データ整形パート
tmp<-read.table("clipboard",header=TRUE,sep="\t",stringsAsFactor=F,na.strings=c("NA","-","－"),check.names=FALSE)
tmp[,1]<-as.Date(tmp[,1])
if(2<ncol(tmp)){
tmp01<-tmp[,c(1,2)]
tmp02<-tmp[,c(1,3)]
}
tmp01<-na.omit(tmp)
tmp02<-na.omit(tmp)
tmp<-merge(tmp01,tmp02);tmp<-na.omit(tmp);tmp000<-tmp;head(tmp);tail(tmp)
# =OFFSET($F$10,(ROW(A1)-1)/12,MOD(ROW(A1)-1,12))
#データ整形パート
```

```{r}
posttitle<-"民主党政権発足から現在(安倍政権)までの建設工事費デフレーター"
datasource<-"国土交通省"
library(ggplot2)
library(xtable)
#library(ggrepel)
#Error: package ‘ggplot2’ 1.0.1 is loaded, but >= 2.0.0 is required by ‘ggrepel’
library(grid)
library(lubridate)
windowsFonts(Meiryo=windowsFont("Meiryo"))
username<-Sys.info()['user']
pathOutput<-paste("C:/Users/",username,"/Desktop/R_Data_Write/",sep="")
setwd(pathOutput);getwd()
SD<-Sys.Date()
ST<-Sys.time()  
addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
png.file<-paste("amcc_",addVer,".png",sep="")
png(file=png.file,width=1000,height=1000)
par(mfrow=c(1,1),family="Meiryo",ps=17,oma=c(3,3,3,2),mar=c(5,5,5,5))
dataset<-subset(tmp,as.Date("2009/9/1")<=tmp[,1])
dataset$Number<-seq(1,nrow(dataset))
dataset$color<-ifelse(dataset[,1]<=as.Date("2012/12/1"),"indianred1","royalblue")
# http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf
minPoint<-min(dataset[,2:3])
maxPoint<-max(dataset[,2:3])
g<-ggplot()
g<-g+geom_point(data=dataset,aes(x=dataset[,2],y=dataset[,3]),color=dataset$color,size=4)
g<-g+ggtitle(
  paste(posttitle,"\nSource:",datasource,"\n赤:民主党 , 青:自民党",sep=""))
g<-g+xlab(colnames(dataset)[2])+ylab(colnames(dataset)[3])
g<-g+theme(plot.title=element_text(size=17,family="Meiryo"))
g<-g+theme(axis.title.x=element_text(size=17,family="Meiryo")) 
g<-g+theme(axis.title.y=element_text(size=17,family="Meiryo")) 
g<-g+theme(axis.text.x=element_text(size=17,angle=0,family="Meiryo")) 
g<-g+theme(axis.text.y=element_text(size=17,angle=90,family="Meiryo"))
#g<-g+geom_line(aes(x=c(minPoint,maxPoint),y=c(minPoint,maxPoint)),color="black")
g<-g+geom_text(data=dataset,aes(x=dataset[,2],y=dataset[,3],label=dataset$Number),
  size=4,vjust=0,hjust=2,family="Meiryo")
g<-g+geom_text(data=dataset,aes(x=dataset[1,2],y=dataset[1,3],
  label=format(dataset[1,1],"%Y-%m")),
  size=6,vjust=1,hjust=0,family="Meiryo")
g<-g+geom_text(data=dataset,aes(x=dataset[nrow(dataset),2],y=dataset[nrow(dataset),3],
  label=format(dataset[nrow(dataset),1],"%Y-%m")),size=6,vjust=1,hjust=1,family="Meiryo")
buf<-subset(dataset,dataset[,1]==as.Date("2012/12/1"))
g<-g+geom_text(data=buf,aes(x=buf[1,2],y=buf[1,3],
  label=format(as.Date("2012/12/1"),"%Y-%m")),size=6,vjust=1,hjust=0,family="Meiryo")
g<-g+geom_path(data=dataset,aes(x=dataset[,2],y=dataset[,3]),color=dataset$color,size=0.5)
print(g)
dev.off()
#table part
htmlFile<-"MINSHUvsJIMIN.html"
cat("",file=htmlFile,append=F)
cat("<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>
<style>
table{width:100%;border-collapse:collapse;padding:0;border-spacing:1;margin-left: auto;margin-right: auto;}
tr, td, th{white-space: nowrap;}
table.amcc tr:nth-child(odd) {background-color: #F5F5F5;}
table.amcc tr:nth-child(even){background-color: #FFFFFF;}
</style>",file=htmlFile,append=T)
cat("<div align=\"center\"><b>",posttitle,"</b></div>",file=htmlFile,append=T)
cat("<b>",colnames(dataset)[4],"</b><div style=\"overflow-x:scroll;\">",file=htmlFile,append=T)
print(xtable(ts(dataset[,4],frequency=12,start=c(year(dataset[1,1]),month(dataset[1,1])))),file=htmlFile,append=T,type="html",include.rownames=T,html.table.attributes="class='amcc'")
cat("</div>",file=htmlFile,append=T)
cat(paste("<div style=\"text-align:center\"><a href=\"http://archive.am-consulting.co.jp/",png.file,
  "\"><img src=\"http://archive.am-consulting.co.jp/",png.file,"\" alt=\"\" title=\"\" width=\"100%\"></a></div><br>",sep=""),file=htmlFile,append=T)
cat("<b>",colnames(dataset)[2],"</b><div style=\"overflow-x:scroll;\">",file=htmlFile,append=T)
print(xtable(ts(dataset[,2],frequency=12,start=c(year(dataset[1,1]),month(dataset[1,1])))),file=htmlFile,append=T,type="html",include.rownames=T,html.table.attributes="class='amcc'")
cat("</div><hr><b>",colnames(dataset)[3],"</b><div style=\"overflow-x:scroll;\">",file=htmlFile,append=T)
print(xtable(ts(dataset[,3],frequency=12,start=c(year(dataset[1,1]),month(dataset[1,1])))),file=htmlFile,append=T,type="html",include.rownames=T,html.table.attributes="class='amcc'")
cat("</div>",file=htmlFile,append=T)
cat("<script>
$(\"tr\").not(':first').hover(
function () {$(this).css(\"background\",\"#8FBC8F\");}, 
function () {$(this).css(\"background\",\"\");}
);
</script>",file=htmlFile,append=T)
#g1<-g+geom_segment(data = dataset,aes(xend=c(tail(dataset[,2],-1),NA),yend=c(tail(dataset[,3],-1),NA)),arrow=arrow(angle=10,length=unit(0.4,"cm"),ends="last",type="open"))
#g1
```