```{r}
library(ggplot2)
library(lubridate)
library(scales)
username<-Sys.info()['user']
pathOutput<-paste("C:/Users/",username,"/Desktop/R_Data_Write/charts/",sep="")
setwd(pathOutput)
windowsFonts()
windowsFonts(Meiryo=windowsFont("Meiryo"))
```

```{r}
chartType<-2 #1:line , 2:bar
fitType<-2 #1:lm , 2:loess
```

```{r}
fun.readData<-function(){
dataset<<-read.table("clipboard",header=TRUE,sep="\t")
head(dataset)
tail(dataset)
}  
```

```{r}
########################################## time series ##########################################
if(colnames(dataset)[1]=="date"){dataset[,1]<-as.Date(dataset[,1])}
buf.colnames<-colnames(dataset)
for(zzz in 2:length(dataset)){
  buf.dataset<-dataset[,c(1,zzz)]  
  SD<-Sys.Date()
  ST<-Sys.time()  
  addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
  creationDate<-paste("作成日:",year(SD),"-",month(SD),"-",day(SD),sep="")  
  png.file<-paste(addVer,".png",sep="")
  png(file=png.file,width=1500,height=1000)
  mainTitle<-buf.colnames[zzz]
  mainTitle<-gsub("source","\nData Source:",mainTitle)
  mainTitle<-gsub("前年同月比\\.","前年同月比(%)\n",mainTitle)
  colnames(buf.dataset)<-c("xvalue","yvalue")
  g<-ggplot()
  switch(chartType,  
    g<-g+geom_line(data=buf.dataset,aes(x=xvalue,y=yvalue),size=2),
    g<-g+geom_bar(data=buf.dataset,aes(x=xvalue,y=yvalue),stat="identity",position="identity",fill="orange",alpha=0.2,color="black")
  )
  switch(fitType,
    g<-g+geom_smooth(data=buf.dataset,aes(x=xvalue,y=yvalue),method=lm,lwd=2),
    g<-g+geom_smooth(data=buf.dataset,aes(x=xvalue,y=yvalue),method=loess,color="red",lwd=2)
  )
  g<-g+theme(plot.title=element_text(size=40,family="Meiryo"))
  g<-g+theme(axis.title.x=element_text(size=20),axis.title.y=element_text(size=20)) 
  g<-g+theme(axis.text.x=element_text(size=30,angle=90,hjust=1),axis.text.y=element_text(size=30)) 
  g<-g+ggtitle(paste(mainTitle,"\n",creationDate))
  if(colnames(dataset)[1]=="date" & regexpr("\\.月次",buf.colnames[zzz])!=-1){  
    g<-g+scale_x_date(labels=date_format("%Y-%m"))  
    g<-g+xlab("")
  }  
  g<-g+ylab("") 
  g<-g+scale_y_continuous(labels=comma)
  print(g)
  dev.off()
}  
dev.off()      
########################################## time series ##########################################
```

```{r}
##########################################  bar chart  ##########################################
fun.readData()
orderType<-3 # 1:as is , 2:xvalue , 3:yvalue
if(colnames(dataset)[1]=="date"){dataset[,1]<-as.Date(dataset[,1])}
buf.colnames<-colnames(dataset)
buf.dataset<-dataset
SD<-Sys.Date()
ST<-Sys.time()  
addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
creationDate<-paste("作成日:",year(SD),"-",month(SD),"-",day(SD),sep="")  
png.file<-paste(addVer,".png",sep="")
png(file=png.file,width=1500,height=1000)
mainTitle<-buf.colnames[2]
mainTitle<-gsub("source","\nData Source:",mainTitle)
mainTitle<-gsub("前年同月比\\.","前年同月比(%)\n",mainTitle)
mainTitle<-gsub("割合","割合(%)",mainTitle)
mainTitle<-gsub("break","\n",mainTitle)
colnames(buf.dataset)<-c("xvalue","yvalue")
if(orderType==1){
rownames(buf.dataset)<-c(1:nrow(buf.dataset))
}else{
rrr<-order(buf.dataset[,(orderType-1)],decreasing=FALSE)
buf.dataset<-buf.dataset[rrr,]
}  
buf.dataset[,1]<-ordered(buf.dataset[,1],levels=buf.dataset[,1][1:length(buf.dataset[,1])])
g<-ggplot()
switch(chartType,  
  g<-g+geom_line(data=buf.dataset,aes(x=xvalue,y=yvalue),size=2),
  g<-g+geom_bar(data=buf.dataset,aes(x=xvalue,y=yvalue),stat="identity",position="identity",fill="orange",alpha=0.2,color="black")
)
g<-g+theme(plot.title=element_text(size=40,family="Meiryo"))
g<-g+theme(axis.title.x=element_text(size=20),axis.title.y=element_text(size=20)) 
g<-g+theme(axis.text.x=element_text(size=30,angle=90,hjust=1),axis.text.y=element_text(size=30)) 
g<-g+ggtitle(paste(mainTitle,"\n",creationDate))
if(colnames(dataset)[1]=="date" & regexpr("\\.月次",buf.colnames[2])!=-1){  
  g<-g+scale_x_date(labels=date_format("%Y-%m"))  
}  
g<-g+scale_y_continuous(labels=comma)
g<-g+xlab("")
g<-g+ylab("") 
print(g)
dev.off()
##########################################  bar chart  ##########################################
```