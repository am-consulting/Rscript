```{r}
library(ggplot2)
library(lubridate)
library(scales)
library(maps)
username<-Sys.info()['user']
pathOutput<-paste("C:/Users/",username,"/Desktop/R_Data_Write/charts/",sep="")
pathJmap<<-paste("C:/Users/",username,"/Desktop/jpn/",sep="")
setwd(pathOutput)
windowsFonts()
windowsFonts(Meiryo=windowsFont("Meiryo"))
chartType<-2 #1:line , 2:bar
fitType<-2 #1:lm , 2:loess
fun.readData<-function(){
  dataset<<-read.table("clipboard",header=TRUE,sep="\t")
  head(dataset)
  tail(dataset)
}  
```

```{r}
########################################## time series ##########################################
setwd(pathOutput)
if(colnames(dataset)[1]=="date"){dataset[,1]<-as.Date(dataset[,1])}
buf.colnames<-colnames(dataset)
for(zzz in 2:length(dataset)){
  buf.dataset<-dataset[,c(1,zzz)]  
  SD<-Sys.Date()
  ST<-Sys.time()  
  addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
  creationDate<-paste("作成日:",year(SD),"-",month(SD),"-",day(SD),sep="")  
  png.file<-paste(addVer,".png",sep="")
  png(file=png.file,width=1500,height=1000)
  mainTitle<-buf.colnames[zzz]
  mainTitle<-gsub("source","\nData Source:",mainTitle)
  mainTitle<-gsub("前年同月比\\.","前年同月比(%)\n",mainTitle)
  colnames(buf.dataset)<-c("xvalue","yvalue")
  g<-ggplot()
  switch(chartType,  
    g<-g+geom_line(data=buf.dataset,aes(x=xvalue,y=yvalue),size=2),
    g<-g+geom_bar(data=buf.dataset,aes(x=xvalue,y=yvalue),stat="identity",position="identity",fill="orange",alpha=0.2,color="black")
  )
  switch(fitType,
    g<-g+geom_smooth(data=buf.dataset,aes(x=xvalue,y=yvalue),method=lm,lwd=2),
    g<-g+geom_smooth(data=buf.dataset,aes(x=xvalue,y=yvalue),method=loess,color="red",lwd=2)
  )
  g<-g+theme(plot.title=element_text(size=40,family="Meiryo"))
  g<-g+theme(axis.title.x=element_text(size=20),axis.title.y=element_text(size=20)) 
  g<-g+theme(axis.text.x=element_text(size=30,angle=90,hjust=1),axis.text.y=element_text(size=30)) 
  g<-g+ggtitle(paste(mainTitle,"\n",creationDate))
  if(colnames(dataset)[1]=="date" & regexpr("\\.月次",buf.colnames[zzz])!=-1){  
    g<-g+scale_x_date(labels=date_format("%Y-%m"))  
    g<-g+xlab("")
  }  
  g<-g+ylab("") 
  g<-g+scale_y_continuous(labels=comma)
  print(g)
  dev.off()
}  
dev.off()      
########################################## time series ##########################################
```

```{r}
##########################################  bar chart  ##########################################
fun.readData()
setwd(pathOutput)
orderType<-3 # 1:as is , 2:xvalue , 3:yvalue
if(colnames(dataset)[1]=="date"){dataset[,1]<-as.Date(dataset[,1])}
buf.colnames<-colnames(dataset)
buf.dataset<-dataset
SD<-Sys.Date()
ST<-Sys.time()  
addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
creationDate<-paste("作成日:",year(SD),"-",month(SD),"-",day(SD),sep="")  
png.file<-paste(addVer,".png",sep="")
png(file=png.file,width=1500,height=1000)
mainTitle<-buf.colnames[2]
mainTitle<-gsub("source","\nData Source:",mainTitle)
mainTitle<-gsub("前年同月比\\.","前年同月比(%)\n",mainTitle)
mainTitle<-gsub("割合","割合(%)",mainTitle)
mainTitle<-gsub("break","\n",mainTitle)
colnames(buf.dataset)<-c("xvalue","yvalue")
if(orderType==1){
rownames(buf.dataset)<-c(1:nrow(buf.dataset))
}else{
rrr<-order(buf.dataset[,(orderType-1)],decreasing=FALSE)
buf.dataset<-buf.dataset[rrr,]
}  
buf.dataset[,1]<-ordered(buf.dataset[,1],levels=buf.dataset[,1][1:length(buf.dataset[,1])])
g<-ggplot()
switch(chartType,  
  g<-g+geom_line(data=buf.dataset,aes(x=xvalue,y=yvalue),size=2),
  g<-g+geom_bar(data=buf.dataset,aes(x=xvalue,y=yvalue),stat="identity",position="identity",fill="orange",alpha=0.2,color="black")
)
g<-g+theme(plot.title=element_text(size=40,family="Meiryo"))
g<-g+theme(axis.title.x=element_text(size=20),axis.title.y=element_text(size=20)) 
g<-g+theme(axis.text.x=element_text(size=30,angle=90,hjust=1),axis.text.y=element_text(size=30)) 
g<-g+ggtitle(paste(mainTitle,"\n",creationDate))
if(colnames(dataset)[1]=="date" & regexpr("\\.月次",buf.colnames[2])!=-1){  
  g<-g+scale_x_date(labels=date_format("%Y-%m"))  
}  
g<-g+scale_y_continuous(labels=comma)
g<-g+xlab("")
g<-g+ylab("") 
print(g)
dev.off()
##########################################  bar chart  ##########################################
```

```{r}
##########################################  Japan Map  ##########################################
fun.readData()
color.set<-c("#f8f8fc","#f1f1f8","#e2e2f1","#c7c7e2","#aaaad5","#8d8dc7","#7272b8","#5555aa","#47478d","#383872","#2b2b55","#1d1d38")
color.set<-c("#f8f8fc","#e2e2f1","#aaaad5","#7272b8","#47478d","#2b2b55")
```

```{r}
#####The following source codes and Japanese comments are the copyright of http://aoki2.si.gunma-u.ac.jp/.
# 塗り分け地図を描く
map <- function(code.list,                  # 描画する都道府県コード
density=NULL,                               # ハッチングの 1 インチあたりの線密度
color=NULL)                                 # 塗り分けに使用する色
{
  map0 <- function(data, dens, color)       # 描画関数
  {
    ### The following codes are added by AMCC.
      setwd(pathOutput)                         
      SD<-Sys.Date()
      ST<-Sys.time()  
      addVer<-gsub("\\.","",paste(year(SD),month(SD),day(SD),hour(ST),minute(ST),second(ST),sep=""))
      creationDate<-paste("作成日:",year(SD),"-",month(SD),"-",day(SD),sep="")  
      png.file<-paste(addVer,".png",sep="")      
      png(file=png.file,width=1500,height=1000) 
      par(mar=c(0,0,12,0),ps=40)
    ### The above codes are added by AMCC.
    continue <- apply(data, 1, any)         # 経度と緯度が共に 0 が描画の区切り
    plot(lon, lat, type = "n", axes=FALSE,  # 大枠を決める
    xlab="", ylab="", bty="n", asp=1,
    main=paste(mainTitle,"\n",creationDate) , cex.main="1.3" , family="Meiryo") # This code is added by AMCC.
    start <- 1
    k <- 0
    for (i in 2:nrow(data)) {
      if (continue[i] == FALSE) {           # 区切れ目
        k <- k+1                            # 何番目の描画か
        if (i-start == 4) {                 # 沖縄を描くときの区画線
          lines(data[start:(i-1),])
        }
        else {
          polygon(data[start:(i-1),], density=dens[k], col=color[k], border="black")
        }
        start <- i+1
      }
    }
    ### The following codes are added by AMCC. Reference http://ds0.cc.yamaguchi-u.ac.jp/~fukuyo/r-map.html
      heightPoly<-40
      basePoly01<-100
      basePoly02<-basePoly01+heightPoly
      widthPoly<-40
      for (ppp in 1:(length(color.set))){
        #時計回りに長方形×1
        xPolygon<-c(0,0,widthPoly,widthPoly,0)
        yPolygon<-c(basePoly01+heightPoly*ppp,basePoly02+heightPoly*ppp,basePoly02+heightPoly*ppp,basePoly01+heightPoly*ppp,basePoly01+heightPoly*ppp)
        polygon(xPolygon, yPolygon, col=color.set[ppp],border="black")
        #時計回りに長方形×1
        if(ppp!=length(color.set)){
          if(ppp!=3){
          text(widthPoly+5,basePoly02+heightPoly*ppp,labels=format(t[ppp],big.mark=",",scientific=F),adj=0)
          }else{
          text(widthPoly+5,basePoly02+heightPoly*ppp,labels=paste(format(t[ppp],big.mark=",",scientific=F),":平均値",sep=""),adj=0)
          }  
        }  
      }    
      dev.off()
    ### The above codes are added by AMCC.
  }
  # 関数本体
  for (i in seq(along=code.list)) {               # 指定した全ての都道府県について
    if (code.list[i] %in% c(15, 28, 47)) {        # 新潟県，兵庫県，沖縄県は描画パーツが 2 つ
      code.list <- c(code.list, -code.list[i])    # コードリストの追加（目印とするために負の数で）
      density <- c(density, density[i])           # 線密度と
      color <- c(color, color[i])                 # 色も追加する
    }
  }
  code.list[code.list == -15] <- 48               # 追加のコードリストに直す
  code.list[code.list == -28] <- 49
  code.list[code.list == -47] <- 50
  lon <- lat <- NULL
  setwd(pathJmap)# Caution:This code is added by AMCC.
  for (i in code.list) {                                     # 指定した全ての都道府県について
    fn <- sprintf("jpn/%02i", i)                             # データファイル名を得る
    gwm <- matrix(scan(fn, quiet=TRUE), ncol=2, byrow=TRUE)  # データを読む
    lon <- c(lon, gwm[,1], 0)                                # 経度を蓄積
    lat <- c(lat, gwm[,2], 0)                                # 緯度を蓄積
  }
  mlon <- min(lon[lon != 0])                                    # 経度の最小値
  mlat <- max(lat[lat != 0])                                    # 緯度の最大値
  lon <- ifelse(lon == 0, 0, lon-mlon+1)                        # 経度の調整
  lat <- ifelse(lat == 0, 0, mlat-lat+1)                        # 緯度の調整
  map0(cbind(as.integer(lon), as.integer(lat)), density, color) # 描画関数を呼ぶ
}
# データにより塗り分け地図を描く
color.map3 <- function(x,  # 長さ 47 の統計データベクトル
t,                         # データを区分する値
color.set)                 # 各区分を塗る色
{
  if (length(t)+1 != length(color.set)) {
    stop("t の長さは color.set の長さより 1 だけ小さくなければならない")
  }
  map(1:47, color=color.set[findInterval(x, t)+1])
}
#########The above source codes and comments are the copyright of http://aoki2.si.gunma-u.ac.jp/.  
```

```{r}
fun.round<-function(buf){
return.buf<<-round(buf/10^floor(log10(buf)),1)*10^floor(log10(buf))
}  
tmp.0<-dataset 
for(iii in 2:length(tmp.0)){
  q<-vector()
  t<-vector()
  q<-NULL
  t<-NULL
  mid<-3 #奇数
  tmp.1<-tmp.0[,iii] 
  if(is.na(sum(tmp.1))==F){
    rrr<-order(tmp.0[,iii])
    tmp.0<-tmp.0[rrr,]
    rownames(tmp.0)<-c(1:nrow(tmp.0))
    tmp.0[,1]<-ordered(tmp.0[,1],levels=tmp.0[,1][1:length(tmp.0[,1])])
    mainTitle<-colnames(tmp.0)[iii]
    mainTitle<-gsub("source","\nData Source:",mainTitle)
    mainTitle<-gsub("前年同月比\\.","前年同月比(%)\n",mainTitle)
    mainTitle<-gsub("割合","割合(%)",mainTitle)
    mainTitle<-gsub("break","\n",mainTitle)
##################凡例パート 
    qmax<-max(tmp.0[,iii]);qmin<-min(tmp.0[,iii])
    q[mid]<-round(max(mean(tmp.0[,iii]),0),4) #caution whether all data under zero or not
    buf<-q[mid]
    fun.round(buf)
    q[mid]<-return.buf
    unit.upper<-round((qmax-q[mid])/mid,4)
    buf<-unit.upper
    fun.round(buf)
    unit.upper<-return.buf
    unit.lower<-round((q[mid]-qmin)/mid,4)
    buf<-unit.lower
    fun.round(buf)
    unit.lower<-return.buf
    for(zzz in 1:(mid-1)){
      q[zzz]<-round(unit.upper*(mid-zzz)+q[mid],4)
      q[zzz+mid]<-round(q[mid]-unit.lower*zzz,4)
    }
    for(zzz in seq(length(q),1,by=-1)){
      t<-c(t,q[zzz])  
    }
    color.map3(tmp.1,t,color.set)
##################凡例パート    
  }
}  
##########################################  Japan Map  ##########################################
```